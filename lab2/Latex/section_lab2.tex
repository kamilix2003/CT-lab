\documentclass[notitlepage, a4paper, 11pt]{article}

\usepackage{geometry}
\geometry{
	a4paper,
	total={170mm,257mm},
	left=20mm,
	top=20mm,
}

\usepackage{wrapfig}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{minted}
\usepackage{tikz}
\usepackage[european resistors]{circuitikz}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{hyperref}
\hypersetup{
	pdfborder = false,
	colorlinks=true,
	linkcolor=black,
	filecolor=black,      
	urlcolor=blue,
	pdftitle={Overleaf Example},
	pdfpagemode=FullScreen,
}
\title{Fourier Series\\
	\large Laboratory II}
\author{Patrycja Nazim, Adrian Kr√≥l, Kamil Chaj}
\date{}

\begin{document}
	\maketitle
	\section{Aim of the exercise}
	The purpose of exercise was to experimentally familiarize with the Fourier series - an operation
	that allows to represent any real periodic signal by the sum of sinusoidal signals. We measured the signals generated by the independent function generator with a vector spectrum analyzer.
	
	\section{What is Fourier Series}
	A Fourier series is an expansion of a periodic function $f(x)$ in terms of an infinite sum of sines and cosines. Fourier series make use of the orthogonal relationships of the sine and cosine functions. The computation and study of Fourier series is known as harmonic analysis and is extremely useful to break up an arbitrary periodic function into a set of simple terms that can be plugged in, solved individually, and then recombined to obtain the solution to the original problem or an approximation to it to whatever accuracy is desired or practical
	
	\section{Course of measurements}
	During our measurements we skipped first part of exercise and measured all signals in configuration for second part (Fig. \ref{fig:Measurements configuration}).
	
	\begin{figure}[H]
		\centering
		\begin{circuitikz}[scale = 0.7, transform shape]
			\ctikzset{bipoles/oscope/width=1.5}
			\ctikzset{bipoles/oscope/height=1}
			\draw (2, 3.5) node[oscopeshape](O) {Oscilloscope};
			\draw [black, thick] (-2.5, 1) rectangle (-0.5, 2.5);
			\draw [black, thick] (6.5, 1) rectangle (4.5, 2.5);
			\draw [black, thick] (0, 0) rectangle (4, 2);
			\draw (-1, 1.75) node[bnc, font=\tiny](CH1) {CH1};
			\draw (5, 1.4) node[bnc, xscale=-1, font=\tiny](INPUT2) {\ctikzflipx{INPUT2}};
			\draw (5, 2.1) node[bnc, xscale=-1, font=\tiny](INPUT1) {\ctikzflipx{INPUT1}};
			\draw (0.5, 1) node[bnc, xscale=-1, font=\tiny](CONX1) {\ctikzflipx{CONX1}};
			\draw (3.5, 1) node[bnc, font=\tiny](CONX2) {CONX2};
			\draw (O.in 1) node[bnc, anchor=zero, rotate=-90](IN1) {};
			\draw (O.in 2) node[bnc, anchor=zero, rotate=-90](IN2) {};
			\draw (CH1.hot) to[short, -*] (-0.3, 1.75) -- (-0.3, 1) -- (CONX1.hot);
			\draw (-0.3, 1.75) to[short] (-0.3, 2.25) to[short, -*] (1.57, 2.25) -- (IN1.hot);
			\draw (1.57, 2.25) to[short] (4.25, 2.25) -- (4.25, 2.1) -- (INPUT1.hot);
			\draw (INPUT2.hot) to[short, -*] (4.25, 1.4) -- (4.25, 1) -- (CONX2.hot);
			\draw (4.25, 1.4) -- (4.25, 1.6) -- (2.42, 1.6) -- (IN2.hot);
			\node [black] at (2, 0.5) {RC Filters};
			\node [black, above] at (-1.5, 2.5) {\small Function Generator};
			\node [black, above] at (5.5, 2.5) {\small Spectrum Analyzer};
		\end{circuitikz}
		\caption{Measurements configuration}
		\label{fig:Measurements configuration}
	\end{figure}
	
	After connecting Function Generator, Spectrum Analyzer, Oscilloscope and board with RC filters according to above configuration (Fig. \ref{fig:Measurements configuration}) we set Function Generator to Amplitude to $V_{pp}$ = 5V and Frequency 1 kHz. 
	With everything set up we proceeded with exercise and recording output of Oscilloscope and Spectrum Analyzer for signals:
	\begin{itemize}
		\setlength\itemsep{0.1em}
		\item Sin wave
		\item Square wave 50\% duty cycle
		\item Square wave 25\% duty cycle
		\item Triangle wave 50\% symmetry ratio
		\item Triangle wave 40\% symmetry ratio
	\end{itemize}
	For Square wave 50\% duty cycle and Triangle wave 40\% symmetry ratio we also recorded Response for both RC Circuits (Fig. \ref{fig: Circuit})
	
	\begin{figure}[H]
		\centering
		\begin{subfigure}{0.45\textwidth}
			\centering
				\begin{circuitikz}[scale = 0.7, transform shape]
				\draw (0,0) node[bnc](B1) {}
				to[R, l=$R_{11}$, a=1.5k$\Omega$] (3,0)
				to[C, l=$C_{11}$, a=47nF] (3,-2)
				node[ground] {}
				;
				\draw (3,0) 
				to[short] (4.5,0)
				node[bnc, xscale=-1](B2){\scalebox{-1}[1]{}}
				;
				\draw node[ground] at (B1.shield) {};
				\draw node[ground] at (B2.shield) {};
			\end{circuitikz}
			\caption{Circuit A}
			\label{fig:Circuit A}
		\end{subfigure}
		\begin{subfigure}{0.45\textwidth}
			\centering
				\begin{circuitikz}[scale = 0.7, transform shape]
				\draw (0,0) node[bnc](B1) {}
				to[R, l=$R_{11}$, a=1.5k$\Omega$] (3,0)
				to[C, l=$C_{11}$, a=47nF] (3,-2)
				node[ground] {}
				;
				\draw (3,0) 
				to[short] (4.5,0)
				node[bnc, xscale=-1](B2){\scalebox{-1}[1]{}}
				;
				\draw node[ground] at (B1.shield) {};
				\draw node[ground] at (B2.shield) {};
			\end{circuitikz}
			\caption{Circuit B}
			\label{fig:Circuit B}
		\end{subfigure}
		\caption{Measured RC Circuits}
		\label{fig: Circuit}
	\end{figure}
	
	\section{Method for calculating Fourier Series coefficients}
	\begin{wrapfigure}[27 ]{R}{0.3\textwidth}
		\centering
		\includegraphics[width=0.3\textwidth]{../Matlab/img/sqr50}
		\caption{example plot}
		\label{fig:example-plot}
	\end{wrapfigure}
	All calculations are made using Matlab with Signal Processing Toolbox, source code can be found in Appendix \ref{sec:source-code}
	
	First step in our calculation is generating signals that we measured during exercise. Pure signals were obtained with built-in functions of Signal Processing Toolbox and Filtered signals were evaluated using NI Multisim SPICE software.
		
	Next step is finding first 10 coefficients of Fourier series for a signal which we calculated by taking inner product of signal with basis vector. In our calculations we used $\sin nt ,\thinspace \cos nt$ and $1$ as our basis vectors.
	\begin{equation}
		a_0 = \left\langle s(t), 1 \right\rangle
	\end{equation}
	\begin{equation}
		a_n = \left\langle s(t), \cos n\omega t \right\rangle
	\end{equation}
	\begin{equation}
		b_n = \left\langle s(t), \sin n\omega t \right\rangle
	\end{equation}

	During exercise we recorded Fourier series of a signal in Amplitude-Phase form so we need to convert $a_n$ and $b_n$ coefficients into amplitude $A_n$ and phase $\varphi_n$
	\begin{equation}
		A_n = \sqrt{a_n^2 + b_n^2}
	\end{equation}
	\begin{equation}
		\varphi_n = \arg(a_n - j b_n)
	\end{equation}
		
	Knowing first 10 coefficients we can plot approximation of a signal using one of following formulas. Example of approximation of square wave is on the second plot in Figure \ref{fig:example-plot}.
	
	\begin{equation}
		s(t) = \frac{a_0}{2} + \sum_{n=1}^{10}(a_n\cos(n\omega t)+b_n\sin(n\omega t))
	\end{equation}
	\begin{equation}
		s(t) = \frac{A_0}{2} + \sum_{n=1}^{10}(A_n\cos(n\omega t +\varphi_n))
	\end{equation}

	For third and fourth plot in Figure \ref{fig:example-plot} we are calculating Discrete Fourier transform for 10 oscillations of a signal using Fast Fourier transform algorithm from Signal Processing Toolbox and then plotting magnitude and argument of FT both in decibel scale on y axis.

	\section{Comparison}
	\subsection{Pure signals}
	\begin{figure}[H]
		\centering
		\begin{subfigure}[][][t]{0.23\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/sin}
			\caption{Sin wave}
		\end{subfigure}
		\hfill
		\begin{subfigure}[][][t]{0.23\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/sqr50}
			\caption{Square wave 50\% duty cycle}
		\end{subfigure}
		\hfill
		\begin{subfigure}[][][t]{0.23\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/sqr25}
			\caption{Square wave 25\% duty cycle}
		\end{subfigure}
		\hfill
		\begin{subfigure}[][][t]{0.23\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/tri50}
			\caption{Triangle wave 50\% symmetry ratio}
		\end{subfigure}
		\caption{Calculated signals}
		\label{fig:pure-signals}
	\end{figure}
	
		\begin{figure}[H]
		\centering
		
		\begin{subfigure}[][][t]{0.23\textwidth}
			\includegraphics[width=\textwidth, trim=85 50 112 45, clip]{../img/osc/DS2_QuickPrint5.png}
			\includegraphics[width=\textwidth, trim=10 80 555 100, clip]{../img/Circuit1/sin}
			\caption{Sin wave}
		\end{subfigure}
		\hfill
		\begin{subfigure}[][][t]{0.23\textwidth}
			\includegraphics[width=\textwidth, trim=85 50 112 45, clip]{../img/osc/DS2_QuickPrint4.png}
			\includegraphics[width=\textwidth, trim=10 80 555 100, clip]{../img/Circuit1/dut50}
			\caption{Square wave 50\% duty cycle}
		\end{subfigure}
		\hfill
		\begin{subfigure}[][][t]{0.23\textwidth}
			\includegraphics[width=\textwidth, trim=85 50 112 45, clip]{../img/osc/DS2_QuickPrint3.png}
			\includegraphics[width=\textwidth, trim=10 80 555 100, clip]{../img/Circuit1/dut25}
			\caption{Square wave 25\% duty cycle}
		\end{subfigure}
		\hfill
		\begin{subfigure}[][][t]{0.23\textwidth}
			\includegraphics[width=\textwidth, trim=85 50 112 45, clip]{../img/osc/DS2_QuickPrint2.png}
			\includegraphics[width=\textwidth, trim=10 80 555 100, clip]{../img/Circuit1/trig50}
			\caption{Triangle wave 50\% symmetry ratio}
		\end{subfigure}
		\caption{Measured signals}
		\label{fig:pure-signals}
	\end{figure}
	
	\subsection{RC filters}
	
	\subsubsection{Low-pass filter}

	\begin{figure}[H]
		\centering
		\begin{subfigure}[][][t]{0.45\textwidth}
			\includegraphics[width=\textwidth, trim=85 50 112 45, clip]{../img/osc/DS2_QuickPrint1.png}
			\includegraphics[width=\textwidth, trim=10 80 10 100, clip]{../img/Circuit1/dut50}
			\caption{Sin wave}
		\end{subfigure}
		\begin{subfigure}[][][t]{0.45\textwidth}
			\includegraphics[width=\textwidth, trim=85 50 112 45, clip]{../img/osc/DS2_QuickPrint4.png}
			\includegraphics[width=\textwidth, trim=10 80 10 100, clip]{../img/Circuit1/trig40}
			\caption{Square wave 50\% duty cycle}
		\end{subfigure}
		\caption{Measured signals}
	\end{figure}
	
	\begin{figure}[H]
		\centering
		\begin{subfigure}{0.45\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/sqr50}
			\caption{Pure signal}
		\end{subfigure}
		\begin{subfigure}{0.45\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/RCLPsqr50}
			\caption{Filtered signal}
		\end{subfigure}
		\caption{Low-pass filter response for Square wave 50\% duty cycle}
	\end{figure}
	\begin{figure}[H]
		\centering
		\begin{subfigure}{0.45\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/tri40}
			\caption{Pure signal}
		\end{subfigure}
		\begin{subfigure}{0.45\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/RCLPtri40}
			\caption{Pure signal}
		\end{subfigure}
		\caption{Low-pass filter response for Triangle wave 40\% symmetry ratio}
	\end{figure}
	
	\subsubsection{High-pass filter}

	\begin{figure}[H]
		\centering
		\begin{subfigure}[][][t]{0.45\textwidth}
			\includegraphics[width=\textwidth, trim=85 50 112 45, clip]{../img/osc/DS2_QuickPrint10.png}
			\includegraphics[width=\textwidth, trim=10 80 10 100, clip]{../img/Circuit2/dut50}
			\caption{Square wave 25\% duty cycle}
		\end{subfigure}
		\begin{subfigure}[][][t]{0.45\textwidth}
			\includegraphics[width=\textwidth, trim=85 50 112 45, clip]{../img/osc/DS2_QuickPrint7.png}
			\includegraphics[width=\textwidth, trim=10 80 10 100, clip]{../img/Circuit2/trig40}
			\caption{Triangle wave 50\% symmetry ratio}
		\end{subfigure}
		\caption{Measured signals}
		\label{fig:pure-signals}
	\end{figure}
	
	\begin{figure}[H]
		\centering
		\begin{subfigure}{0.45\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/sqr50}
			\caption{Pure signal}
		\end{subfigure}
		\begin{subfigure}{0.45\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/RCHPsqr50}
			\caption{Filtered signal}
		\end{subfigure}
		\caption{High-pass filter response for Square wave 50\% duty cycle}
	\end{figure}
	\begin{figure}[H]
		\centering
		\begin{subfigure}{0.45\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/tri40}
			\caption{Pure signal}
		\end{subfigure}
		\begin{subfigure}{0.45\textwidth}
			\includegraphics[width=\textwidth]{../Matlab/img/RCHPtri40}
			\caption{Filtered signal}
		\end{subfigure}
		\caption{High-pass filter response for Triangle wave 40\% symmetry ratio}
	\end{figure}
		
	\section{Summary}
	
	\newpage
	\appendix
	\section{Source Code}\label{sec:source-code}
	\href{https://github.com/kamilix2003/CT_labs}{GITHUB repository}
	\subsection*{lab2.m}
	\inputminted{matlab}{../Matlab/lab2.m}
	\subsection*{Final Plots.m}
	\inputminted{matlab}{../Matlab/Final_Plots.m}
%	\subsection*{Fourier.m}
%	\inputminted{matlab}{../Matlab/Fourier.m}
%	\subsection*{fourier coefficient.m}
%	\inputminted{matlab}{../Matlab/fourier_coefficient.m}
	\subsection*{Import csv.m}
	\inputminted{matlab}{../Matlab/RC_circuit.m}
\end{document}